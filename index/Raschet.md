# Миниатюры    

## Расчет расстояний по поверхности Земли

В этой статье предпринимается попытка оптимизации алгоритмов:

Расчета расстояния по поверхности Земли без учета рельефа местности в км между двумя точками – исходной и конечной;

Расчета кратчайшего расстояния в км между двумя точками –исходной и конечной через «пронизывание поверхностного слоя» Земли;



Расчета азимута на конечную точку при нахождении в начальной точке.

Условием при разработке алгоритмов явилось возможное использование исключительно аппарата элементарной математики. То есть алгебры, тригонометрии, не более. При этом без использования геометрии и тригонометоии на сфере и элементов векторной алгебры.


Исходные данные для расчета: Средний радиус Земли, Координаты исходной и конечной точек (широта в градусах от 0 до 90 градусов (N – северная или S – южная) и долгота в градусах от 0 до 180 градусов (W – западная или E – восточная).

В качестве примечания используем цитату из «Википедии»:


Примечание: Форма Земли (геоид) близка к сплюснутому эллипсоиду. Расхождение геоида с аппроксимирующим его эллипсоидом достигает 100 метров. Средний диаметр планеты составляет примерно 12742 км, а окружность — около 40 000 км, поскольку метр в прошлом определялся как 1/10 000 000 расстояния от экватора до северного полюса через Париж (из-за неправильного учёта полюсного сжатия Земли эталон метра 1795 года оказался короче приблизительно на 0,2 мм, отсюда неточность). Вращение Земли создаёт экваториальную выпуклость, поэтому экваториальный диаметр на 43 км больше, чем полярный.


Принятые обозначения:

R –Средний радиус Земли. R=6371 км;

П – пи (отношение длины окружности к диаметру). П =3,1416;

An - Координата северной широты, (угол в градусах, 0…90);

As - Координата южной широты , (0…90);

Aw - Координата западной долготы, (0…180);

Aе - Координата восточной долготы, (0…180);

Ans - Удаленность по широте между начальной и конечной точками в градусах;

Awe – Удаленность по долготе между начальной и конечной точками в градусах;

Hns - Составляющая расстояния в км напрямую по хорде между начальной и конечной точками (через часть поверхностного слоя Земли), взятая по меридиану (прямая удаленность по широте);

Uns - Составляющая расстояния в км по поверхности Земли с учетом ее среднего радиуса между начальной и конечной точками, взятая по меридиану ( дуговая удаленность по широте);

Hwe - Составляющая расстояния в км напрямую по хорде между начальной и конечной точками (через часть поверхностного слоя Земли), взятая по широте (прямая удаленность по долготе);

Uwe - Составляющая расстояния в км по поверхности Земли с учетом ее среднего радиуса между начальной и конечной точками, взятая по широте ( дуговая удаленность по долготе).


При расчетах используем только общепринятые в геометрии и тригонометрии формулы, соотношения и определения угловых, дуговых и линейных величин на окружности и в сфере, формулы приведения, а также общепринятые в географии понятия широты, долготы, их принятые угловые характеристики, понятия меридиана, экватора, полушарий.


Пусть для читателя не покажутся сложными и громоздкими ниже используемые формулы и шаблоны для расчетов. В их основе – исключительно общеизвестные понятия элементарной математики. Алгебры и тригонометрии. Для желающих проанализировать выражения для лучшего понимания прошу учесть, что обозначения величин и индексов при них даются по возможности по начальным буквам соответствующих английских слов.

А именно:
R – Radius (Радиус), H – cHord (хорда), A-Angle (угол), U – Arch (дуга), AZ –Azimuth – (Азимут), N – Noth (север), S – South (Юг), E – East (Восток), W –West (Запад). Сходные по сути индексы различаются добавлением цифр – 1 и 2.

И так далее.


Формулы для расчета (их вывод опускается как очевидный):


Hns = R* 2* sin (Ans/2)
Uns = R*П*Ans/180

Hwe = R*2*sin(90-Ans)*sin(Awe/2)

Uwe = R *П*sin(90 –Ans)*Awe/90


Мысленно соединим исходную и конечную точки с центром Земли. Естественно, что они от него будут равноудалены на величину, равную радиусу Земли, равному R.
На центральный угол «A» между этими двумя радиусами будет опираться хорда «Н», по величине, равная прямому и кратчайшему расстоянию между исходной и конечной точками (через часть поверхностного слоя Земли).
В то же время рассмотрим очевидное геометрическое построение:


![изображение](https://github.com/user-attachments/assets/e3832407-77e0-44ec-b26a-00ba7e240c24)


Здесь: AD=BC=H


AB=Hwe2 (Для Ростова, например)


СD=Hwe1 (Для Сиднея, например)


АС=ВD=Hns



 

Следует учесть тот не совсем очевидный факт, что и AC и BD – это меридианы. Оба они фактически направлены с севера на юг. Они действительно равны друг другу. Просто они проведены из разных точек. Как по долготе, так и по широте. Ведь фактически направление, скажем, точно на Юг, будет разным для разных точек с разными координатами. А при перерезании мысленно Земли плоскостью, проходящей через эти четыре точки и при построении вспомогательной трапеции именно так и будет. Длины оснований трапеции определяются прежде всего разницей по долготе между исходной и конечной точками. А вот наклон боковых граней определяется прежде всего разницей по широте между исходной и конечной точками. Именно в этом состоит сложность в понимании и нераспространенность достаточно широко используемого метода решения.

CO=KD=(CD-AB)/2=(Hwe1-Hwe2)/2

(Угол) CAO =arcsin[ (Hwe1-Hwe2)/(2*Hns)]

AO=AC*cos CAO=Hns*cos{arcsin[(Hwe1-Hwe2)/(2*Hns)]}

(Угол) OAD=arctg(OD/AO)=arctg{[Hwe2+(Hwe1-Hwe2)/2]/[Hns*cos|arcsin(Hwe1--Hwe2)/(2*Hns)|]}

Н=OD/sinOAD


 
Очевидно, что нужный для расчетов центральный угол A будет равен:


A = 2*arcsin [(H/(2*R)]

Дуга же «L» этого центрального угла по поверхности Земли (не по хорде!) и будет равняться расстоянию между исходной и конечной точкой. Именно по поверхности Земли, по ее среднему радиусу:
L = 2*П*R*A/360

Пример расчета.
Умышленно берем самый общий случай, относительно сложный, для вычислений:


Исходная точка: Россия, Ростов-на Дону, дом на ул. Зорге, 62
Координаты - 47 градусов 13 мин 40 сек (N), 39 градусов 37 мин 50 сек (E)

Конечная точка: Australia, Sydney, Abbotsford, дом на Blackwall Point Rd
Координаты – 33 градуса 51 мин 06 сек (S), 151 градусов 07 мин 50 сек (E)



Расчет далее в градусах и его долях:


An1 = 47 + 13/60 + 40/3600 = 47+0,2167+0,0111= 47,3277

Ae1 = 39 + 37/60 + 50/3600= 39+0,6167+ 0,0139=39,6306

As1 = 33+ 51/60 + 06/3600 = 33+ 0,8500+ 0,0017= 33,7517

Ae2 = 151 + 07/60+ 50/3600 = 151+0,1167+ 0,0139= 151,1306

Ans = An1 + As1 ( в разных полушариях – Северном и Южном)

Awe= Ae2 – Ae1 (оба в Восточном полушарии)

Ans = 47,3277 + 33,7517 = 81,0794 градуса

Awe= 151,1306 – 39,6306 = 111,5000 градуса


Расстояние от Ростова до Сиднея с севера на Юг по меридиану не зависит от того по какому меридиану рассчитывается. И по хорде и по дуге.
На любой широте на каждый градус прохождения по широте приходится один и тот же путь по меридиану, а именно, например по дуге:
2*П*R/360 = 2*3,1416*6371/360 = 111,195 (км).

Сидней южнее Ростова по дуге меридиана (по поверхности Земли) на
2*П*R/360* Ans = 111,195* 81,0794 = 9015,639 км

По хорде же, естественно меньше, вычисляем по формуле:


Hns = R* 2* sin (Ans/2) = 6371*2* sin (81,0794/2) = 12742*sin40,5397 = 12742*0,64997 = 8281,979

Hns=8281,979 км

Расстояние же от Ростова до Сиднея с запада на восток по широте зависит от того, по какой широте оно берется. Например, по хордам:

На широте Ростова:


Hwe2 = R*2*sin(90-An1)*sin(Awe/2)= 6371*2* sin (90-47,3277)*sin(111,5000/2)=12742*sin42,6723*sin55,75= 12742*0,67780*0,82659=7138,867

На широте Сиднея:Hwe1 = R*2*sin(90-As1)*sin(Awe/2)= 6371*2* sin (90-33,7517)*sin(111,5000/2)=12742*sin56,2483*sin55,75= 12742*0,83145*0,82659=8757,172
Для вычисления кратчайшего расстояния по прямой под Землей между Ростовом и Сиднеем воспользуемся приведенной выше формулой:
 
 
H= 11450,217 (км)

Кратчайшим путем перемещения между Ростовом и Сиднеем будет перемещение по оптимальному для этого маршрута азимуту. Азимут – это угол, направление на цель.
По определению , азимут - это угол – от 0 до 360 градусов. 0 – север (N), 90 – восток (Е), 180 – юг (S), 270 – запад (W). 0 и 360 эквивалентны. В южном полушарии в некоторых странах за 0 азимута принято направление на юг. Но достоверных данных на этот счет у меня нет.

Интуитивно и очевидно, что путь от Ростова до Сиднея – примерно на SE (юго-восток).

Определим азимут по возможности более точно. Потому, что при этом, составляющие этого угла понадобится для перерасчета пути до Сиднея по хорде и путь по дуге (по поверхности Земли).
Азимут AZ в данном случае будет:


AZ = 180 - OAD

Где 180 градусов угол азимута на Юг а угол OAD - составляющая угла , что очевидно на приложенном выше рисунке.

Так как:


(Угол) OAD=arctg(OD/AO)=arctg{[Hwe2+(Hwe1-Hwe2)/2]/[Hns*cos|arcsin(Hwe1--Hwe2)/(2*Hns)|]}

Этот угол уже использовался в приведенных выше расчетах. Он равен 43,95849 градуса

OAD= 43,9585 градуса

Соответственно: Азимут AZ =180-43,9585= 136,0415 градуса

AZ = 136,0415 градуса

Примечание: Этот азимут есть направление примерно на юго-восток. Точно на Юго – восток будет 135 градусов,Соответственно от Сиднея на Ростов азимут будет по этим правилам будет примерно на Северо- запад. С ошибкой чуть более 1 углового градуса.

Теперь определяем расстояние между Ростовом и Сиднеем по дуге (по поверхности Земли). Воспользуемся ранее приведенными формулами:


L = 2*П*R*A/360

A = 2*arcsin [(H/(2*R)]

A=2*arcsin [(11450,217 /(2*6371)]=2*arcsin 0,89862 =2*63,97726=127,9545 градуса

L =2*3,1416*6371*127,9545 /360 =14227,925 км

L = 14227,925 км

Ориентировочные проверки результатов вычислений общедоступными средствами:


1 . По глобусу:

Окружность глобуса – 810 мм;Расстояние от Ростова до Сиднея – 288 мм.
L = 2*3,1416*6371*290/810 =40030,2672*288/810 = 14232 км.

Окружность по экватору и расстояние между исходным и конечным пунктами измерял за неимением лучшего примитивным хлопчатобумажным “сантиметром» для шитья. Совпадение 14227/14232 =0,99964, то есть 99,964% просто поразило. До некоторой степени – это просто случайное совпадение, так как измерение глобуса с окружностью всего 810 мм (и соответственно диаметром 259 мм) данными средствами измерения с приемлемой точностью измерять просто некорректно!

2. Измерение с помощью инструмента «Линейка» в программе Google Earth (Планета Земля) дало прямой результат, равный 14223,100 км
 
Совпадение 14223,100/14227,925 =0,99966, то есть 99,966% уже никак нельзя назвать случайным совпадением. Так как и эта проверка была не единственно возможным способом. Есть и другие. Но они, скорее всего, не требуются.
4. Калькулятор по ссылке: http://www.garmin.com.ua/tools/calc.php?typ=0&n1=30&e1=60&n2=15&e2=67
 
Это как я понял – автоматизированная программ для данных расчетов.Называется она «Калькулятор расстояния и азимута по географическим координатам». То есть рассчитывает не только расстояние, но и азимут. Казалось бы, - то что нужно. Но есть 4 «но».

Измерение расстояния дает результат, равный 14218,367 км .Совпадение 14218,367/14227,925 = 0.99932, то есть 99,932% тоже такого же порядка, как и в сравнении с Google. Однако чуть больше. Проанализировать расхождения не представляется возможным.

a) Авторы программы перемудрили с вводом отрицательных чисел, когда берут как отрицательные числа для угловых координат в южном и западном полушариях (координаты по S и W). Там у них явная ошибка в алгоритме.

b) Сам алгоритм программы неизвестен. Хотя интерфейс и простота пользования – на уровне.

c) Как видно из названия программа высчитывает также и азимут. Но делает это с огромной ошибкой. Измерение азимута от Ростова до Сиднея дает результат101,154°.

Несовпадение 136,0415 – 101,154= 34,888°. Или 34,888/136,0415 = 0,2564, то есть 25,64%. С одной стороны, это говорит о явной грубой ошибке в алгоритме. Причем у них, а не у меня. Так как даже грубая прикидка, о чем я уже писал в статье, показывает, что азимут направления Ростов – Сидней будет примерно на SE, то есть примерно 135°.И 101,154° азимут быть ну просто никак не может. Конечно очень трогательно, что результат выдается с точностью до третьего знака после запятой?!


7. Программа PLANETCALC Онлайн калькуляторы.
8. 
Можно найти по ссылке http://planetcalc.ru/713/Называется «Путевой угол и расстояние между двумя точками по локсодроме (линии румба).»Это, пожалуй лучшее, из того, что я просмотрел. Интерфейс во всяком случае великолепный. Рассчитывает и расстояние по поверхности и Азимут. Более того, есть попытка учесть в приближении и более правильную форму Земли. Например, не только шар, но и Референц-элипсоид…
Измерение расстояния дает результат «по шару» 14396,6345 км.Совпадение 14227,925/14396,6345 = 0, 98828 то есть 98, 83% .A по «Референц-элипсоиду» - 14371,7968 кмСовпадение 14227,925/14371,7968 = 0, 98998 то есть 99, 00% .То есть совпадение на порядок ниже, но также для практического использования вполне приемлемое.

А вот результаты вычисления азимута,скажем «по шару» - 128,8242°.

Несовпадение 136,0415 – 128,8242 = 7,21°. То есть весьма много, для практического применения – критично. Но ближе, в сравнении с предыдущей разработкой. Здесь те же недоумения. Кроме того, экскурсы авторов в 16 век к Меркатору, приведенные формулы высшей математики для расчета путевого угла, а особенно приведенные на сайте внизу отзывы и замечания на форуме более, чем настораживают.
Настораживает и сопоставление трех фактов:


а) Судя по рекламной графике и картинкам программа рассчитана на целевую аудиторию – ориентации автолюбителей;

b) Использование «морских» терминов типа «румб», «путевой угол», «расстояние по локсодроме», связанное с расстоянием между двумя точками…

с) Ссылка на навигационные карты мира. Которые для решения этой задачи в современном мире абсолютно не необходимы. Более того, при современной геолокации через спутники и определения географических координат нахождения в том числе.

То есть и вся математика притянута с целью удовлетворения этих посылок.
В том числе и по форме Земли.

Ничего не имею против, конечно. Однако, многое именно притянуто, причем «за уши». Так как для реальных практических расчетов это излишне. Корректность же алгоритмов остается за пределами моего понимания. Как и значительное несовпадение по азимуту. Назначение же программы – также.


Выводы:

1. Методика и точность расчетов соответствуют ожиданиям. 
3. И картографы России 30 лет назад (мой глобус не просто примитивный, но даже древний), и специалисты Google пользовались примерно такими же алгоритмами, использовали аналогичные многократно проверенные данные. 
5. Неточности в сотые доли процента являются, скорее всего, результатами моего округления до четвертого – пятого – шестого десятичного знака после запятой в процессе вычислений. Это можно легко избежать предельно повысив точность вычисления 
7. Скорее всего, специалисты Google так же пренебрегли отклонениями формы Земли от идеального шара, отмеченные выше как ссылка из Википедии. Вряд ли они учитывали в этой опции и рельеф местности, так как рассчитанная мной трасса проходит через Тибет, и Гималаи, причем в высокогорной их части. Если учитывать рельеф, то ошибка была бы в сотни км. 
9. Формулы для расчета с помощью компьютера и автоматизированной программы, которую легко написать, - относительно не сложные. 
11. Однако прикидка алгоритма, аналогов которого я не нашел в интернете, заняла определенное время. Расчеты с достаточной степенью точности – тоже. В связи с этим я с трудом представляю, каким образом подобные расчеты делались во времена Колумба и Магеллана. Ведь без постоянного расчета азимута и знания расстояния до цели любое целенаправленное перемещение превращалось в практически крайне сложно выполняемую задачу. А уж они-то уж точно этим очень даже интересовались. Знали мало, приличных инструментов для наблюдения толком не было, тригонометрии с достаточной точностью практически тоже. И точность наблюдения данных и расчетов была на два порядка ниже. Все имеющиеся таблицы и ранее собранные данные были очень сомнительными. 
13. Сама сложившаяся практика задания угловых координат в географии крайне не очевидная, с трудом поддается анализу и затрудняет расчеты. 
15. Интересно, авторы аналогичных программ и алгоритмов расчетов хотя бы делали прикидочную оценку полученной точности? В сравнении с «конкурентами», например. 
17. Лучшим инструментом по данной тематике на мой взгляд является программа Google Earth. К многочисленным ее достоинствам – и еще мое доверие к ней "в плюс".
 
yury 16.01.2014




